<rolltemplate class="sheet-rolltemplate-salvageunion">
    <div class="sheet-template-container">
        <h3>{{name}}</h3>
        <div class="sheet-results">
            <h4>Roll: {{roll1}}</h4>
            <h4>{{{computed::roll1}}}</h4>
        </div>
    </div>
</rolltemplate>
<script type="text/worker">
    const buttonlist = ["pilot", "mech", "notes"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });
    const classData = {
      "standardClasses": [
        {"id": "salvager", "name": "Salvager"},
        {"id": "hacker", "name": "Hacker"},
        {"id": "engineer", "name": "Engineer"},
        {"id": "hauler", "name": "Hauler"},
        {"id": "scout", "name": "Scout"},
        {"id": "soldier", "name": "Soldier"}
      ],
      "advancedClasses": [
        {"id": "cyborg", "name": "Cyborg"},
        {"id": "fabricator", "name": "Fabricator"},
        {"id": "union_rep", "name": "Union Rep"},
        {"id": "smuggler", "name": "Smuggler"},
        {"id": "ranger", "name": "Ranger"}
      ]
    };
    on('clicked:core_mechanic', () => {
        startRoll("&{template:salvageunion} {{name=Core Mechanic Roll}} {{roll1=[[1d20]]}}", (results) => {
            let total = results.results.roll1.result;
            let computed;

            // Define the custom result based on the roll
            if (total == 20) {
                computed = 'Nailed it: You have overcome the odds and managed an outstanding success. You may achieve an additional bonus of your choice to the action. When dealing damage, you can choose to double it or pick another appropriate bonus effect.';
            } else if (total >= 11 && total <= 19) {
                computed = 'Success: You have achieved your goal without any compromises. When attacking, you hit the target and deal standard damage.';
            } else if (total >= 6 && total <= 10) {
                computed = 'Tough Choice: You succeed in your action, but at a cost. The Mediator gives you a Tough Choice with some kind of Setback attached. When attacking, you hit, but must make a Tough Choice';
            } else if (total >= 2 && total <= 5) {
                computed = 'Failure: You have failed at what you were attempting to do. You face a Setback of the Mediator\'s choice. When attacking, you miss the target.';
            } else if (total == 1) {
                computed = 'Cascade Failure: Something has gone terribly wrong. You suffer a severe consequence of the Mediator\'s choice. When attacking, you miss the target and suffer a Setback chosen by the Mediator.';
            }

            finishRoll(
                results.rollId,
                {
                    'roll1': computed,
                }
            );
        });
    });
    on('clicked:group_initiative', () => {
        startRoll("&{template:salvageunion} {{name=Group Initiative Roll}} {{roll1=[[1d20]]}}", (results) => {
            let total = results.results.roll1.result;
            let computed;

            if (total == 20) {
                computed = 'You Shot First: Two Pilots chosen by the players act first. Play then passes to the NPC group and one NPC chosen by the Mediator acts next.';
            } else if (total >= 11 && total <= 19) {
                computed = 'Quickdraw: One Pilot chosen by the players acts first. Play then passes to the NPC group and one NPC chosen by the Mediator acts.';
            } else if (total >= 6 && total <= 10) {
                computed = 'Wait and See: One NPC chosen by the players acts first. Play then passes to the player group and one Pilot chosen by the players acts.';
            } else if (total >= 2 && total <= 5) {
                computed = 'Fumble: One NPC chosen by the Mediator acts first. Play then passes to the player group and one Pilot chosen by the players acts.';
            } else if (total == 1) {
                computed = 'Ambush:  Two NPCs chosen by the Mediator act first. Play then passes to the player group and one Pilot is chosen by the players to act next. ';
            }

            finishRoll(
                results.rollId,
                {
                    'roll1': computed,
                }
            );
        });
    });
</script>
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="pilot" />
<input type="hidden" name="attr_class" value="salvager" />
<input type="hidden" name="attr_hp" value="10" />
<input type="hidden" name="attr_hp_max" value="10" />
<input type="hidden" name="attr_ap" value="5" />
<input type="hidden" name="attr_ap_max" value="5" />
<input type="hidden" name="attr_tp" value="0" />

<!-- Table for roll results -->
<input type="hidden" name="attr_Core-Mechanic" value="" />

<div class="roller-buttons-wrapper">
    <button type="action" name="act_core_mechanic">Roll Core Mechanic</button>
    <button type="action" name="act_group_initiative">Group Initiative Roll</button>
    <button type="action" name="act_group_retreat">Group Retreat Roll</button>
    <button type="action" name="act_critical_damage">Critical Damage Roll</button>
    <button type="action" name="act_critical_injury">Critical Injury Roll</button>
    <button type="action" name="act_reactor_overload">Reactor Overload Roll</button>
    <button type="action" name="act_area_salvage">Area Salvage Roll</button>
    <button type="action" name="act_mech_salvage">Mech Salvage Roll</button>

</div>
<div class="sheet-tabs-wrapper">
    <button type="action" name="act_pilot">Pilot</button>
    <button type="action" name="act_mech">Mech</button>
    <button type="action" name="act_notes">Notes</button>
    <!-- Action Points (AP) -->
    <div class="sheet-ap">
        <span>
            <label data-label-tooltip="Your pilot's role on the crew which enables them to take unique abilities." for="ap_current">AP:</label>
            <input type="number" name="attr_ap" id="ap_current" value="5" />
        </span>
        /
        <span>
            <label data-label-tooltip="Your pilot's role on the crew which enables them to take unique abilities." for="ap_max">Max:</label>
            <input type="number" name="attr_ap_max" id="ap_max" value="5" />
        </span>
    </div>
</div>
<div class="sheet-pilot sheet-stats">
    <!-- Health Points (HP) -->
    <div class="sheet-hp">
        <span>
            <label data-label-tooltip="Your pilot's role on the crew which enables them to take unique abilities." for="hp_current">HP</label>
            <input type="number" name="attr_hp" id="hp_current" value="10" />
        </span>
        /
        <span>
            <label data-label-tooltip="Your pilot's role on the crew which enables them to take unique abilities." for="hp_max">Max:</label>
            <input type="number" name="attr_hp_max" id="hp_max" value="10" />
        </span>
    </div>

    <!-- Training Points (TP) -->
    <div class="sheet-tp">
        <span>
            <label data-label-tooltip="Your pilot's role on the crew which enables them to take unique abilities." for="tp">TP:</label>
            <input type="number" name="attr_tp" id="tp" value="0" />
        </span>
    </div>
</div>
<div class="sheet-pilot">
    <div class="sheet-column-left">
        <h2>Pilot</h2>
        <span>Statistics, abilities, and inventory for your Salvage Union Pilot.</span>
        <img name="attr_character_avatar" alt="Pilot Avatar" id="pilot-avatar"/>
        <div class="pilot-inline-attribute">
            <label data-label-tooltip="Your pilot's role on the crew which enables them to take unique abilities." for="class">Class:</label>
            <select name="attr_class" id="class">
                <option value="salvager">Salvager</option>
                <option value="hacker">Hacker</option>
                <option value="engineer">Engineer</option>
                <option value="hauler">Hauler</option>
                <option value="scout">Scout</option>
                <option value="soldier">Soldier</option>
                <option value="cyborg">Cyborg</option>
                <option value="fabricator">Fabricator</option>
                <option value="union_rep">Union Rep</option>
                <option value="smuggler">Smuggler</option>
                <option value="ranger">Ranger</option>
            </select>
        </div>
        <!-- Pilot Information Fields -->
        <div class="pilot-inline-attribute">
            <label data-label-tooltip="The name everyone in your crawler refers to your pilot as." for="pilot_callsign">Callsign:</label>
            <input type="text" name="attr_callsign" id="pilot_callsign" />
        </div>
        <div class="pilot-inline-attribute">
            <label data-label-tooltip="A phrase your pilot happens to be fond of using. Can be uttered as a free action or reaction to re-roll dice. See Pg. 19 in the Workshop Manual." for="pilot_motto">Motto:</label>
            <input type="text" name="attr_motto" id="pilot_motto" />
        </div>
        <div class="pilot-inline-attribute">
            <label data-label-tooltip="An item that is personal and important to your pilot. Can enable re-rolls, per Pg. 18 in the Workshop Manual." for="pilot_keepsake">Keepsake:</label>
            <input type="text" name="attr_keepsake" id="pilot_keepsake" />
        </div>
        <div class="pilot-block-attribute">
            <label data-label-tooltip="The appearance of your pilot, can include gender, pronouns, their look, clothing, and more." for="pilot_appearance">Appearance:</label>
            <textarea name="attr_appearance" id="pilot_appearance"></textarea>
        </div>
        <div class="pilot-block-attribute">
            <label data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="pilot_background">Background:</label>
            <textarea name="attr_background" id="pilot_background"></textarea>
        </div>
    </div>
    <div class="sheet-column-right">
        <!-- Abilities -->
        <div class="sheet-abilities">
            <h3>Abilities</h3>
            <fieldset class="repeating_abilities">
                <div class="sheet-ability">
                    <input type="text" name="attr_ability_name" placeholder="Name"/>
                    <textarea name="attr_ability_description" placeholder="Description"></textarea>
                    <input type="number" name="attr_ability_ap" placeholder="AP Value" min="0"/>
                    <select name="attr_ability_range">
                        <option value="Close">N/A</option>
                        <option value="Close">Close</option>
                        <option value="Medium">Medium</option>
                        <option value="Long">Long</option>
                        <option value="Far">Far</option>
                    </select>
                    <select name="attr_ability_actiontype">
                        <option value="Passive">Passive</option>
                        <option value="Free">Free</option>
                        <option value="Reaction">Reaction</option>
                        <option value="Turn">Turn</option>
                        <option value="Short">Short</option>
                        <option value="Long">Long</option>
                        <option value="Downtime">Downtime</option>
                    </select>
                </div>
            </fieldset>
        </div>

        <!-- Inventory -->
        <div class="sheet-inventory">
            <h3>Inventory</h3>
            <fieldset class="repeating_inventory">
                <div class="sheet-inventory">
                    <span class="inventory-item">
                        <input type="text" name="attr_inventory_name" placeholder="Name"/>
                        <input type="number" name="attr_inventory_count" placeholder="#" min="0"/>
                    </span>
                    <textarea name="attr_inventory_description" placeholder="Description"></textarea>
                </div>
            </fieldset>
        </div>
    </div>
</div>
<div class="sheet-mech sheet-stats">
    <!-- Structure Points (SP) -->
    <div class="sheet-sp">
        <span>
            <label data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="sp">SP</label>
            <input type="number" name="attr_sp" id="sp" value="" />
        </span>
        /
        <span>
            <label data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="sp_max">Cap:</label>
            <input type="number" name="attr_sp_max" id="sp_max" value="" />
        </span>
    </div>

    <!-- Energy Points (EP) -->
    <div class="sheet-ep">
        <span>
            <label data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="ep">EP:</label>
            <input type="number" name="attr_ep" id="ep" value="" />
        </span>
        /
        <span>
            <label  data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="ep_max">Cap:</label>
            <input type="number" name="attr_ep_max" id="ep_max" value="" />
        </span>
    </div>

    <!-- Heat -->
    <div class="sheet-heat">
        <span>
            <label  data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="heat">HEAT:</label>
            <input type="number" name="attr_heat" id="heat" value="" />
        </span>
        /
        <span>
            <label data-label-tooltip="Where your pilot came from, or who they were before joining the Union Crawler." for="heat_max">Cap:</label>
            <input type="number" name="attr_heat_max" id="heat_max" value="" />
        </span>
    </div>
</div>
<div class="sheet-mech">
    <div class="sheet-column-left">
        <h2>Mech</h2>
        <div class="sheet-chassis-info">
            <div>
                <label data-label-tooltip="" for="mech_name">Name:</label>
                <input type="text" name="attr_mech_name" id="mech_name" />
            </div>
        </div>
        <img name="attr_character_token">
        <h3>Chassis Stats</h3>
        <div class="sheet-chassis-info">
            <div>
                <label for="mech_chassis">Chassis:</label>
                <input type="text" name="attr_mech_chassis" id="mech_chassis" />
            </div>
            <div>
                <label for="mech_pattern">Pattern:</label>
                <input type="text" name="attr_mech_pattern" id="mech_pattern" />
            </div>
            <div>
                <label data-label-tooltip="" for="mech_quirk">Quirk:</label>
                <input type="text" name="attr_mech_quirk" id="mech_quirk" />
            </div>
            <div class="mech-appearance-block">
                <label data-label-tooltip="" for="mech_appearance">Appearance:</label>
                <textarea name="attr_mech_appearance" id="mech_appearance">
                </textarea>
            </div>
        </div>
        <div class="sheet-chassis-stats">
            <div>
                <label for="mech_system_slots">System Slots:</label>
                <input type="number" name="attr_mech_system_slots" id="mech_system_slots" />
            </div>
            <div>
                <label for="mech_module_slots">Module Slots:</label>
                <input type="number" name="attr_mech_module_slots" id="mech_module_slots" />
            </div>
            <div>
                <label for="mech_cargo_cap">Cargo Cap.:</label>
                <input type="number" name="attr_mech_cargo_cap" id="mech_cargo_cap" />
            </div>
            <div>
                <label for="mech_tech_level">Tech Level:</label>
                <input type="number" name="attr_mech_tech_level" id="mech_tech_level" />
            </div>
            <div>
                <label for="mech_salvage_value">Salvage Value:</label>
                <input type="number" name="attr_mech_salvage_value" id="mech_salvage_value" />
            </div>
        </div>
    </div>
    <div class="sheet-column-right">
        <h3>Systems & Modules</h3>
        <fieldset class="repeating_systems">
            <div class="sheet-systems">
                <span class="systems-item">
                    <label data-label-tooltip="Name of the system. e.g. Escape Hatch" for="systems_name">Name:</label>
                    <input type="text" name="attr_systems_name"  id="systems_name" placeholder="Name"/>
                </span>
                <span class="systems-item">
                    <label data-label-tooltip="Tags for the system - descriptive tags that don't fit the other fields. Melee, Recommended, e.g." for="systems_tags">Tags:</label>
                    <input type="text" name="attr_systems_tags"  id="systems_tags" placeholder="Tags - Melee, Salvaging e.g."/>
                </span>
                <span class="systems-item">
                    <label data-label-tooltip="Tech level of the system or module. Requires prerequisite Mech chassis that meets the tech level requirement." for="systems_tech_level">Tech LVL:</label>
                    <select id="systems_tech_level" name="attr_systems_tech_level">
                        <option value="T1">T1</option>
                        <option value="T2">T2</option>
                        <option value="T3">T3</option>
                        <option value="T4">T4</option>
                        <option value="T5">T5</option>
                        <option value="T6">T6</option>
                    </select>
                </span>
                <span class="mech-appearance-block">
                    <label data-label-tooltip="Description of the system or module. How does it work and what does it do?" for="systems_description">Description:</label>
                    <textarea name="attr_systems_description" id="systems_description" placeholder="Description"></textarea>
                </span>
            </div>
        </fieldset>
        <h3>Cargo</h3>
    </div>
</div>

<div class="sheet-notes">
    <h2>Notes</h2>
    <span>Notes go here</span>
</div>